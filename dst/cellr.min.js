!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.cellr=i()}(this,function(){"use strict";function t(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}function i(i,s){var r=s(i),n=r._constructor;return delete r._constructor,n.prototype=i.prototype?t(Object.create(i.prototype),r):r,n}var s=i({},function(t){return{_constructor:function(){this._cbs={}},emit:function(t){var i=this._cbs[t];if(i&&i.length){for(var s=[],r=1,n=arguments.length;r<n;r++)s.push(arguments[r]);for(var r=0,n=i.length;r<n;r++)i[r].apply(this,s)}},on:function(t,i){var s=this._cbs;s[t]=s[t]||[],s[t].push(i)}}}),r=i(s,function(t){function i(){n=!0;for(var t=r.pl,i=h;i<=e;i++)for(var s=t[i],o=0,f=s.length;o<f;o++)s[o].calc();r.pl={},h=1,e=-1,n=!1}var s=null,r={pl:{}},n=!1,h=1,e=-1;return{_constructor:function(i){t.call(this),this.fw=[],this.bw=[],this.lv=0,this.pl=-1,"function"==typeof i?(this._c=i,this.st=0):(this._v=i,this.st=2)},calc:function(){if(this._c){if(1==this.st)throw new Error("circular");this.st=1;var t=this.bw,i=[];this.bw=i;var r=s;s=this;var n=this._c();s=r;for(var h=0,e=t.length;h<e;h++){var o=t[h];if(i.indexOf(o)!=-1){var f=o.fw,c=f.indexOf(this);c>-1&&f.splice(c,1)}}this.pl=-1,this.set(n)}},get:function(){var t=s;return t&&(this.fw.push(t),t.bw.push(this)),0==this.st&&this._plan(),h<=this.lv&&!n&&i(),t&&t.lv<=this.lv&&(t.lv=this.lv+1),this._v},set:function(t){var i=!(this._v==t);if(this._v=t,this.st=2,i)for(var s=this.fw,r=0,n=s.length;r<n;r++)s[r]._plan()},_plan:function(){var t=this.lv,i=this.pl;if(i!=t){var s=r.pl;if(i>t){var n=s[i];if(n){var o=n.indexOf(this);o>-1&&n.splice(o,1)}}var f=s[t];f||(f=[],s[t]=f),f.push(this),this.pl=t,t<h&&(h=t),t>e&&(e=t)}}}}),n={Cell:r};return n});
