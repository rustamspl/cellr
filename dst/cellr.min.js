!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.cellr=i()}(this,function(){"use strict";function t(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}function i(i,s){var e=s(i),h=e._constructor;return delete e._constructor,h.prototype=i.prototype?t(Object.create(i.prototype),e):e,h}function s(){if(y){var t=E.relPl;y=!1,C=!0;for(var i=t[b];;){var s=i&&i.shift();if(s){var e=s._lev,h=s._chEvt;if(!h){if(e>b||-1==s._levInRel){if(!i.length){if(b==w)break;i=t[++b]}continue}if(s.clc(),e=s._lev,h=s._chEvt,e>b){i.length||(i=t[++b]);continue}}if(s._levInRel=-1,h){var n=b;s._fixedValue=s._val,s._chEvt=null,d.call(s,h);for(var l=s._pushInd,r=s._fws,_=0,c=r.length;c>_;_++){var a=r[_];a._lev<=e&&(a._lev=e+1),l>=a._pushInd&&(a._pushInd=l,a._chEvt=null,a._addToRel())}if(b!=n){i=t[b];continue}}if(!i.length){if(b==w)break;i=t[++b]}}else{if(b==w)break;i=t[++b]}}if(b=g,w=-1,C=!1,I++,o){var u=o;o=null;for(var f=0,v=u.length;v>f;f++)u[f]()}}}var e={log:function(){}};console&&console.log&&(e.log=function(){console.log.apply(console,arguments)});var h,n=Object.is||function(t,i){return 0===t&&0===i?1/t==1/i:t===i||t!=t&&i!=i},l=i({},function(){return{_constructor:function(){this._cbs={}},emit:function(t){t.type||(t={type:t});var i=this._cbs[t.type];if(i){var s=i.cbs;if(s.length)for(var e=i.ctx,h=0,n=s.length;n>h;h++)s[h].call(e[h],t)}},on:function(t,i,s){var e=this._cbs,h=e[t]=e[t]||{cbs:[],ctx:[]};h.cbs.push(i),h.ctx.push(s||this)},off:function(t,i,s){var e=this._cbs[t];if(e){var h=e.cbs,n=e.ctx,l=h.indexOf(i);l>-1&&n[l]===s&&(h.splice(l,1),n.splice(l,1))}}}}),r=Function("return this;")();if(r.process&&"[object process]"==process.toString()&&process.nextTick)h=process.nextTick;else if(r.setImmediate)h=function(t){setImmediate(t)};else if(r.Promise&&-1!=Promise.toString().indexOf("[native code]")){var _=Promise.resolve();h=function(t){_.then(function(){t()})}}else{var c;r.addEventListener("message",function(){if(c){var t=c;c=null;for(var i=0,s=t.length;s>i;i++)try{t[i]()}catch(e){r.console&&r.console.log&&r.console.log(e)}}}),h=function(t){c?c.push(t):(c=[t],postMessage("__tic__","*"))}}var o,a=h,u=l.prototype,f=u.on,v=u.off,d=u.emit,g=Number.MAX_SAFE_INTEGER||9007199254740991,p=0,E={relPl:{}},b=g,w=-1,y=!1,C=!1,x=null,m={original:null},I=1,R=i(l,function(t){return{_constructor:function(i,s){t.call(this),s||(s={}),this.owner=s.owner||this,this._clc="function"==typeof i?i:null,this._validate=s.validate||null,this._clc?this._fixedValue=this._val=void 0:(this._validate&&this._validate(i,void 0),this._fixedValue=this._val=i,i instanceof l&&i.on("change",this._onValCh,this)),this._error=null,this._inited=!1,this._curlyClcing=!1,this._active=!1,this._hasFols=!1,this._pushInd=0,this._ver=0,this._bws=void 0,this._fws=[],this._lev=0,this._levInRel=-1,this._status=null,this._chEvt=null,this._canCancelCh=!0,this._lastErrEvt=null},on:function(t,i,e){return y&&s(),this._act(),f.call(this,t,i,arguments.length>=3?e:this.owner),this._hasFols=!0,this},off:function(){return y&&s(),v.apply(this,arguments),this._fws.length||this._cbs.change||this._cbs.error||!this._hasFols||(this._hasFols=!1,this._deact()),this},_regSl:function(t){this._act(),this._fws.push(t),this._hasFols=!0},_unregSl:function(t){this._fws.splice(this._fws.indexOf(t),1),this._fws.length||this._cbs.change||this._cbs.error||(this._hasFols=!1,this._deact())},_act:function(){if(this._clc&&!this._active&&null!==this._bws){var t=this._bws;if(this._ver<I){var i=this._tryClc();(t||this._bws||!this._inited)&&(i===m?this._fail(m.original):this._push(i,!1,!1)),t=this._bws}if(t){var s=t.length;do t[--s]._regSl(this);while(s);this._active=!0}}},_deact:function(){if(this._active){var t=this._bws,i=t.length;do t[--i]._unregSl(this);while(i);-1==this._levInRel||this._chEvt||(this._levInRel=-1),this._active=!1}},_addToRel:function(){var t=this._lev;if(!(t<=this._levInRel)){var i,e=E.relPl;(e[t]||(e[t]=i=[],i)).push(this),b>t&&(b=t),t>w&&(w=t),this._levInRel=t,y||C||(y=!0,a(s))}},_onValCh:function(t){this._pushInd=++p,this._chEvt?(t.prev=this._chEvt,this._chEvt=t,this._val===this._fixedValue&&(this._canCancelCh=!1)):(t.prev=null,this._chEvt=t,this._canCancelCh=!1,this._addToRel())},get:function(){if(y&&this._clc&&s(),this._clc&&!this._active&&this._ver<I&&null!==this._bws){var t=this._bws,i=this._tryClc(),e=this._bws;if(t||e||!this._inited){if(e&&this._hasFols){var h=e.length;do e[--h]._regSl(this);while(h);this._active=!0}i===m?this._fail(m.original):this._push(i,!1,!1)}}if(x){var n=x._bws,l=this._lev;n?-1==n.indexOf(this)&&(n.push(this),x._lev<=l&&(x._lev=l+1)):(x._bws=[this],x._lev=l+1)}return this._val},clc:function(){if(!this._clc)return!1;y&&s();var t,i,e=this._hasFols;e&&(t=this._bws,i=this._lev);var h=this._tryClc();if(e){var n=this._bws,l=0;if(n){var r=n.length;do{var _=n[--r];t&&-1!=t.indexOf(_)||(_._regSl(this),l++)}while(r)}if(t&&(n?n.length-l:0)<t.length)for(var c=t.length;c;){var t=t[--c];n&&-1!=n.indexOf(t)||t._unregSl(this)}if(this._active=!(!n||!n.length),C&&this._lev>i)return this._addToRel(),!1}return h===m?(this._fail(m.original),!0):this._push(h,!1,!0)},_tryClc:function(){if(this._curlyClcing)throw new TypeError("Circular deps");var t=x;x=this,this._curlyClcing=!0,this._bws=null,this._lev=0;try{return this._clc()}catch(i){return m.original=i,m}finally{x=t,this._ver=I+C,this._curlyClcing=!1}},set:function(t){var i=this._val;return this._validate&&this._validate(t,i),this.push(t),this},push:function(t){return this._push(t,!0,!1),this},_push:function(t,i,s){this._inited=!0;var e=this._val;if(i&&C&&this._hasFols){if(n(t,e))return this._setError(null),!1;var h=this;return(o||(o=[])).push(function(){h._push(t,!0,!1)}),!0}return(i||!C&&s)&&(this._pushInd=++p),this._setError(null),n(t,e)?!1:(this._val=t,e instanceof l&&e.off("change",this._onValCh,this),t instanceof l&&t.on("change",this._onValCh,this),this._hasFols?this._chEvt?n(t,this._fixedValue)&&this._canCancelCh?(this._levInRel=-1,this._chEvt=null):this._chEvt={target:this,type:"change",oldValue:e,value:t,prev:this._chEvt}:(this._chEvt={target:this,type:"change",oldValue:e,value:t,prev:null},this._canCancelCh=!0,this._addToRel()):((i||!C&&s)&&I++,this._fixedValue=t,this._ver=I+C),!0)},_fail:function(t){e.log(t),t instanceof Error||(t=new Error(String(t))),this._setError(t)},_setError:function(t){(t||this._error)&&(this._error=t,t&&this._hErrEvt({type:"error",error:t}))},_hErrEvt:function(t){if(this._lastErrEvt!==t){this._lastErrEvt=t,d.call(this,t);for(var i=this._fws,s=0,e=i.length;e>s;s++)i[s]._hErrEvt(t)}}}}),F={Cell:R};return F});