!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.cellr=i()}(this,function(){"use strict";function t(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}function i(i,s){var e=s(i),n=e._constructor;return delete e._constructor,n.prototype=i.prototype?t(Object.create(i.prototype),e):e,n}var s,e=i({},function(t){return{_constructor:function(){this._cbs={}},emit:function(t){var i=this._cbs[t];if(i&&i.length){for(var s=[],e=1,n=arguments.length;e<n;e++)s.push(arguments[e]);for(var e=0,n=i.length;e<n;e++)i[e].apply(this,s)}},on:function(t,i){var s=this._cbs;s[t]=s[t]||[],s[t].push(i)}}}),n=Function("return this;")();if(n.process&&"[object process]"==process.toString()&&process.nextTick)s=process.nextTick;else if(n.setImmediate)s=function(t){setImmediate(t)};else if(n.Promise&&Promise.toString().indexOf("[native code]")!=-1){var r=Promise.resolve();s=function(t){r.then(function(){t()})}}else{var o;n.addEventListener("message",function(){if(o){var t=o;o=null;for(var i=0,s=t.length;i<s;i++)try{t[i]()}catch(t){n.console&&n.console.log&&n.console.log(t)}}}),s=function(t){o?o.push(t):(o=[t],postMessage("__tic__","*"))}}var c=s,h=i(e,function(t){function i(){n=!0;for(var t=e.pl,i=o;i<=h;i++)for(var s=t[i],c=0,f=s.length;c<f;c++)s[c].calc();e.pl={},o=r,h=-1,n=!1}var s=null,e={pl:{}},n=!1,r=268435455,o=r,h=-1;return{_constructor:function(i){t.call(this),this.fw=[],this.bw=[],this.lv=0,this.pl=-1,"function"==typeof i?(this._c=i,this.st=0,this._plan()):(this._v=i,this.st=2)},calc:function(){if(this._c){if(1==this.st)throw new Error("circular");this.st=1;var t=this.bw,i=[];this.bw=i;var e=s;s=this;var n=this._c();s=e;for(var r=0,o=t.length;r<o;r++){var c=t[r];if(i.indexOf(c)!=-1){var h=c.fw,f=h.indexOf(this);f>-1&&h.splice(f,1)}}this.pl=-1,this._set(n)}},get:function(){var t=s;if(t){t.bw.push(this);var e=this.fw;e.indexOf(t)==-1&&e.push(t)}return 0==this.st&&this._plan(),o<=this.lv&&!n&&i(),t&&t.lv<=this.lv&&(t.lv=this.lv+1),this._v},_set:function(t){var i=!(this._v==t);if(this._v=t,this.st=2,i){for(var s=this.fw,e=0,n=s.length;e<n;e++)s[e]._plan();this.emit("change",t)}},set:function(t){this._set(t),c(i)},_plan:function(){var t=this.lv,i=this.pl;if(i!=t){var s=e.pl;if(i>t){var n=s[i];if(n){var r=n.indexOf(this);r>-1&&n.splice(r,1)}}var c=s[t];c||(c=[],s[t]=c),c.push(this),this.pl=t,t<o&&(o=t),t>h&&(h=t)}}}}),f={Cell:h};return f});
