!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.cellr=i()}(this,function(){"use strict";function t(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}function i(i,s){var n=s(i),r=n._constructor;return delete n._constructor,r.prototype=i.prototype?t(Object.create(i.prototype),n):n,r}var s=i({},function(t){return{_constructor:function(){this._cbs={}},emit:function(t){var i=this._cbs[t];if(i&&i.length){for(var s=[],n=1,r=arguments.length;n<r;n++)s.push(arguments[n]);for(var n=0,r=i.length;n<r;n++)i[n].apply(this,s)}},on:function(t,i){var s=this._cbs;s[t]=s[t]||[],s[t].push(i)}}}),n=i(s,function(t){function i(){r=!0;for(var t=n.pl,i=e;i<=o;i++)for(var s=t[i],f=0,c=s.length;f<c;f++)s[f].calc();n.pl={},e=h,o=-1,r=!1}var s=null,n={pl:{}},r=!1,h=268435455,e=h,o=-1;return{_constructor:function(i){t.call(this),this.fw=[],this.bw=[],this.lv=0,this.pl=-1,"function"==typeof i?(this._c=i,this.st=0):(this._v=i,this.st=2)},calc:function(){if(this._c){if(1==this.st)throw new Error("circular");this.st=1;var t=this.bw,i=[];this.bw=i;var n=s;s=this;var r=this._c();s=n;for(var h=0,e=t.length;h<e;h++){var o=t[h];if(i.indexOf(o)!=-1){var f=o.fw,c=f.indexOf(this);c>-1&&f.splice(c,1)}}this.pl=-1,this.set(r)}},get:function(){var t=s;if(t){t.bw.push(this);var n=this.fw;n.indexOf(t)==-1&&n.push(t)}return 0==this.st&&this._plan(),e<=this.lv&&!r&&i(),t&&t.lv<=this.lv&&(t.lv=this.lv+1),this._v},set:function(t){var i=!(this._v==t);if(this._v=t,this.st=2,i){for(var s=this.fw,n=0,r=s.length;n<r;n++)s[n]._plan();this.emit("change")}},_plan:function(){var t=this.lv,i=this.pl;if(i!=t){var s=n.pl;if(i>t){var r=s[i];if(r){var h=r.indexOf(this);h>-1&&r.splice(h,1)}}var f=s[t];f||(f=[],s[t]=f),f.push(this),this.pl=t,t<e&&(e=t),t>o&&(o=t)}}}}),r={Cell:n};return r});
